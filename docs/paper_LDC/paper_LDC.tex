\documentclass[aps,showpacs,12pt,onecolumn,prd,superscriptaddress,nofootinbib]{revtex4}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{latexsym}
\usepackage{graphicx}
\usepackage{bm}
\usepackage{color}
\usepackage{enumerate}
\usepackage{ulem}

\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand\ud{{\mathrm{d}}}
\newcommand\uD{{\mathrm{D}}}
\newcommand\calO{{\mathcal{O}}}
\newcommand\bfx{\mathbf{x}}
\newcommand{\ov}[1]{\overline{#1}}
\newcommand{\ph}[1]{\phantom{#1}}
\newcommand{\cte}{\mathrm{cte}}
\newcommand{\nn}{\nonumber}
\newcommand{\hatk}{\hat{k}}
\newcommand{\Hz}{\,\mathrm{Hz}}
\newcommand{\sinc}{\,\mathrm{sinc}}
\newcommand{\Msol}{M_{\odot}}
\newcommand{\bsub}{\begin{subequations}}
\newcommand{\esub}{\end{subequations}}
\newcommand\betaL{{\beta_{L}}}
\newcommand\lambdaL{{\lambda_{L}}}
\newcommand\varphiL{{\varphi_{L}}}
\newcommand\psiL{{\psi_{L}}}
\newcommand\C{{\cos(4\psi)}}
\newcommand\mc{{\mathcal{M}}}

\newcommand{\jgb}[1]{{\color{DarkGreen} #1}}

\begin{document}

\title{Methods for black hole merger parameter estimation with LISA.}

\author{John G. Baker}
\affiliation{Gravitational Astrophysics Laboratory, NASA Goddard Space Flight Center, 8800 Greenbelt Rd., Greenbelt, MD 20771, USA}
\author{Sylvain Marsat}



\date{\today}

\begin{abstract}

[Abstract]

\end{abstract}

\pacs{
04.70.Bw, % classical black holes
04.80.Nn, % Gravitational wave detectors and experiments
95.30.Sf, % relativity and gravitation
95.55.Ym, % Gravitational radiation detectors
97.60.Lf  % black holes (astrophysics)
}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}
\label{sec:intro}
This report provides methods and results in a successful effort to characterize a massive black hole binary (MBHB) merger as part fo the first round ``Radler' LISA Data Challenge (LDC) campaign.  The challenge included simulated data for a LISA observation of a single MBHB system with parameters drawn from a simulated population. We conducted a Bayesian treatment of the problem with full-range naive priors for all parameters (except for moderate restriction on the coalescence time. This note provides details on the methodology applied to infer MBHB system parameters and more detailed results beyond those included in the broader LDC Radler analysis.

\section{Methodology}

The simulated MBHB observation in the LDC1.1 dataset included a signal for a non-precessing MBHB system which merged during the observation period using the PhenomD waveform model. The version of LISA assumed in the simulation was ***. The LISA response for the frequency domain dataset was implemented using the leading-order approximation of the approach in Ref.~\cite{MarsatEA2018} in a python implementation.  The dataset corresponds to about 42 million time samples at 10s cadence, adding to the challenge of computing likelihoods fast enough to support a full Bayesian search. Sec.~\ref{sec:definition} specifies the problem definition including the parmeterization and generally naive assumed priors.

To enable a suitably fast likelihood computation required several development through the Radler campaign.  First we developed fast, but python-accessible version of our previous strictly C-based code for the LISA response signal processing defining the core of the \texttt{lisabeta} package, which has also already been applied in several LISA parameter estimation studies. Those other studies provided fast likelihood computation by taking we also required a fast-but-accurate method for computing likelihood, but for the LDC we needed a fast way to compute likelihoods with noisy data. We discuss out straightforward approach to this in Sec.~\ref{sec:likelihood}.

We applied MCMC sampling to characterize the posterior using the code \texttt{ptmcmc} we had previously developed.  That code generally takes a relatively naive brute-force approach to MCMC sampling applying parallel tempering to promote full model space exploration an generally relying on a general-purpose proposal distribution components. For this problem, we added an interface to enable applying ore problem-specific proposal elements. And applied a set of proposals based on approximate symmetries identified in Ref.~\cite{Marsat2020} which can lead to specific parameter degeneracies. The details of that treatment are described in ~\ref{sec:MCMC}.

\subsection{ Parameters and Priors }
\label{sed:definition}
(So far this is verbatim from our submission.)

%We have attempted to name the parameters consistently with the LDC conventions, using inclination and polarization angles which should be consistent with LDC manual eqs 16/17. In the samples, CoalescenceTime is measured at the SSB.  These are not quite the same as the parameters used in the sampling (see Prior).  In some cases, for efficiency, we have marginalized over the phi (PhaseAtCoalescence) parameter in the likelihood calculation and though this parameter is present, in should meaninglysly recover the uniform prior.

We generally applied broad uninformative priors across the parameter space. Table~\ref{tab:prior} shows the full list of parameters and their prior distributions.

\begin{table}
  \label{tab:prior}
  \centering
  \begin{tabular}{llll}
    Name & Symbol & Units & Prior \\
    \hline
    chirp mass & $\mc$ & $\Msol$ & $\mathrm{Log}[14650.8,1.46508e+08]$\\
    mass ratio & $q$ & - &$\mathrm{Log}[0.0333333,1]$\\
    primary spin & $a1$ & - & $[-0.9,1]$\\
    secondary spin & $a2$ & - & $[-0.9,1]$\\
    coalescence time (LISA-frame) & $t_{cL}$ & s & $[2.396e+07,2.596e+07]$\\
    distance & $d$ & Mpc & $\mathrm{Log}[186.687,1.68018e+07]$\\
    inclination & $\iota$ & rad & $\mathrm{Polar}[0,3.14159]$\\
    orbital phase & $\varphi$ & rad & $[0,6.28319]$\\
    longitude (LISA-frame) & $\lambda_L$ & rad & $[0,6.28319]$\\
    latitude (LISA-frame) &$\beta_L$ & rad & $\mathrm{CoPolar}[-1.5708,1.5708]$\\
    polarization angle (LISA-frame) & $\psi_L$ & rad & $[0,3.14159]$\\
    \hline
  \end{tabular}
  \caption{ MBHB parameters and priors. Here $\mathrm{Log}[]$ indicates a log-uniform distribution over the range, while $\mathrm{Polar}[]$ ($\mathrm{CoPolar}[]$) correspond to polar (co-polar) angle distributions consistent a uniform distribution on a sphere.}
\end{table}

Among the intrisic parameters, rather than in terms of individual component masses, we define our problem in terms of chirp mass $\mc$ and mass ratio $q$ applying broad-range log-uniform priors on each parameter, spanning a factor of $10^4$ in $\mc$ and allowing $q \sim [1/30,1]$.  We applied uniform priors on the spin parameters across almost the full physical range, but excluding relatively extreme anti-aligned spins, for which the waveform model sometimes failed.

The extrinsic parameters which relate to the arrival of the signal at LISA, we use specialized parameters, where the time, sky-location and polarization angle are set with reference to the orientation of LISA at merger time.  We converted these to the Solar-System Barycentric(SSB) referenced parameters for our LDC entry.  We assumed full-range circle or sphere-uniform priors for all angle parameters. The only parameter for which we did not assume more-or-less the full plausible range was the merger time $t_c$.  Our method for accelerating the likelihood so far is inaccurate outside of a rough window. We use a uniform time window with a width of 2 million seconds.

We also note that we have not attempted to relate our orbital phase $\varphi$ reference with that of the LDC.


\subsection{Likelihood computation}
\label{sec:likelihood}

\subsection{Bayesian sampling}
\label{sec:MCMC}

\section{Results}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Symmetries}

In \cite{MarsatEA2019} we have discussed symmetries which apply to LISA in low-frequency, minimal-motion limit, or more generally any GW instrument in this limit which measures both polarization modes. In this context, we use sky coordinates adapted $\{\beta_{L},\lambda_{a}\}$ adapted to the instrument. Since $\iota \in [0, \pi]$ while $\beta_{L} \in [-\pi/2, \pi/2]$, it will be more convenient to work with $\theta_{L} = \pi/2 - \beta_{L}$ and we further abbreviate notations by using the variables
\be
	t_{\iota} \equiv \tan \frac{\iota}{2} \,, \quad t_{\theta} \equiv \tan \frac{\theta_{L}}{2} \,.
\ee
We write the response signals for a single-mode circularly radiating source via complex combinations of the two polarization channels (having already factored out the intrinsic parameters and having integrated over the Fourier domain),
\be
	\sigma_{\pm} \equiv s_{a}^{22} \pm i s_{e}^{22} \,.
\ee
In this notation, we obtain
\bsub\label{eq:sigmapm}
\begin{align}
  \sigma_{+} &= \rho e^{2i\varphi} \left[ t_{\theta}^{4} e^{-2 i \psiL} + t_{\iota}^{4} e^{2 i \psiL} \right] e^{-2i \lambda_{a}} \,, \\
  \sigma_{-} &= \rho e^{2i\varphi} \left[ e^{-2 i \psiL} + t_{\theta}^{4} t_{\iota}^{4} e^{2 i \psiL} \right] e^{2i \lambda_{a}} \,,
\end{align}
\esub
with a common prefactor 
\be\label{eq:sigmafactorrho}
\rho(d, \iota, \theta_{L}) = \frac{1}{4d\left( 1 + t_{\iota}^{2} \right)^{2} \left(1 + t_{\theta}^{2} \right)^{2}} \,.
\ee

Having measured $\sigma_{+}$ and $\sigma_{-}$ from some observation with assumed intrinsic parameters, we can now count 4 (real) constraints, for the 6 remaining intrinsic parameters.  This leaves us with a degenerate subspace described by disjoint 2-D pieces.

We can regard this as the basic degenerate space for a 2-polarization GW observation, with opportunities for degeneracy breaking with multiple harmonic modes, an accelerating detector, and/or detector with a size comparable to the GW wavelength.  MCMC performance should usually be improved by applying proposals which exploit the symmetries of the degenerate space, which we can understand from examplination of \eqref{eq:sigmapm,eq:sigmafactorrho}.

There are a number of discrete symmetries evident. First, we can rotate the source or instrument through $\pi/4$ with a corresponding rotation of the polarization angle,
\begin{align}
  \phi\rightarrow\phi+\pi/4&\mathrm{and}&\psi\rightarrow\psi+\pi/4\\
  \lambda\rightarrow\lambda+\pi/4&\mathrm{and}&\psi\rightarrow\psi+\pi/4.
\end{align}
The first, for instance, just changes the sign on the $\phi$ exponentials and the $\psi$ exponentials. 

Next we note a symmetry associated with reflecting the location of the observation through the instrument plane, 
\be\label{eq:symmetryresponse}
\betaL \rightarrow -\betaL\,, \quad \iota \rightarrow \pi - \iota \,, \quad \psiL \rightarrow \pi - \psiL,
\ee
whereby  $t^4_{\theta}->t^{-4}_{\theta}$ and $t^4_{\iota}->t^{-4}_{\iota}$,
leaving the response exactly invariant.

There is also a symmetry which exchanges the altidual angle of the GW receiver and transmitter, i.e. exchanging $\iota \leftrightarrow \theta_{L}$. While leaving $\sigma_-$ unchanged, this conjugates the factor inside brackets for $\sigma_{+}$, which can be compensated using the phase terms $\varphi \pm \lambda_{a}$. If $\Phi = \mathrm{Arg} \left[ t_{\theta}^{4} e^{-2 i \psiL} + t_{\iota}^{4} e^{2 i \psiL} \right]$, we obtain the symmetry
\begin{align}
	\iota' = \theta_{L} \,, \qquad \theta_{L}' = \iota \,, \nn\\
	\varphi' = \varphi + \frac{1}{2} \Phi \quad \mathrm{mod} \; \pi\,, \nn\\
	\lambda_{a}' = \lambda_{a} - \frac{1}{2} \Phi \quad \mathrm{mod} \; \pi\,.
\end{align}

We can also describe the continuous symmetry describing movement within the 2-D subspace by exchanging distance $d$ with some combination of $\iota$ and $\beta$ in  \eqref{eq:sigmafactorrho}.  This requires also ensuring that changes to $t^4_{\theta}$ and $t^4_{\iota}$ do not alter \eqref{eq:sigmapm}.

First, for an approximate approach, note that in the limit that either $t^4_\theta<<1$ or $t^4_\iota<<1$, then \eqref{eq:sigmapm} become nearly independent of that quantity except through  $\rho$ in \eqref{eq:sigmafactorrho}. Similarly if $t^4_\iota>>1$ then dependence is only through $t^4_\iota\rho$. We can approximately represent both possibilities allowing transformations which preserve $d(1+t^2_\iota)^2/(1+t^4_\iota)=2d/(\cos^2(\iota)+1)$,
\begin{align}
  \iota&\rightarrow\iota'\\
  d&\rightarrow d'\frac{(1+\cos^2{\iota'})}{(1+\cos^2{\iota})}.
\end{align}
Another option at the same level of approximation is preserve $d/\cos(\iota)$, but this may be less appropriately when $\cos(\iota)->0$.  In some MCMC tests, the latter form acheived better autocorrelations, although the former had slightly higher acceptance rates. A corresponding symmetry exists when $t^4_\theta<<1$.  

It is also possible to explicitly formulate this symmetry in the general case.
To approach this, we represent subspace of the parameter space, with coordinates $\{x=\min\{t^4_\theta,t^4_\iota\},y=\max\{t^4_\theta,t^4_\iota\},C=\cos(4\psi),d\}$ trivially related to our basic coordinates, but better adapted for this problem.

Consider an exact generalization of the distance-inclination symmetry. For this we use coordinates $\{z=xy,\Delta=(|\sigma_-|^2-|\sigma_+|^2)/\rho^2,S=|\sigma_-|^2/\rho^2,\rho\}$.  Of these latter coordinates, the last 3 will be considered fixed within the orbits of the symmetry, though only 2 combinations of these are fully specified by the observed constraints on \eqref{eq:sigmapm}. The remaining coordinate $z$ is free within $S^{1/2}-1\leq z\leq 1-\Delta$. The transformation to these coordinates is
\begin{align}
  z&=xy\\
  \Delta&=(1-x^2)(1-y^2)\\
  S&=1+x^2y^2+2xyC\\
  D&=d(1+x^{1/2})^2(1+y^{1/2})^2.
\end{align}
The symmetry is realized by any translation in $z\rightarrow z$, the new coordinates are ten recovered from the inverse transformation is 
\begin{align}
  x&=\sqrt{\Lambda(z,\Delta)-\delta(z,\Delta)}\\
  y&=\sqrt{\Lambda(z,\Delta)+\delta(z,\Delta)}\\
  C&=\frac{S-1-z^2}{2z}\\
  d&=\frac D{(1+x(z,\Delta)^{1/2})^2(1+y(z,\Delta)^{1/2})^2},
\end{align}
with $\Lambda=(1+z^2-\Delta^2)/2$ and $\delta=\sqrt{\Lambda^2-z^2}$.
Then to complete the transformation, since the argument of the complex argument of the factors in square brackets in \eqref{eq:sigmapm} will have changed, it is necessary to complete the specification by choosing $\lambda$ and $\phi$ to preserve the argument of the full expressions.

For application as a proposal, the Jacobian of the transformation is needed.  This is straightforward to compute explicitly for the forward transformation above, and its inverse can be evaluated using the same expression with the transformed coordinates.  It is also necessary to include the Jacobian for the steps not made explicit.


Now consider a full 2-D space of symmstry transformations,
We use the following notation for convenience:
\begin{align}
  x&=t^4_{\theta}=\tan^4{\theta/2}\\
  y&=t^4_{\iota}=\tan^4{\iota/2}\\
  z&=xy^s\\
  \hat w&=x/y^s\\
  R&=|\sigma_-/\sigma_+|^2\\
  &=\frac{x^2+y^2+2xy\C}{1+x^2y^2+2xy\C}\\
  &=\left(\frac{\hat w+\hat w^{-1}+2\C}{z+z^{-1}+2\C}\right)^s\\
  \Delta&=16(|\sigma_-|^2-|\sigma_+|^2)\\
  &=\frac{(1-x^2)(1-y^2)}{d^2(1+x^{1/2})^4(1+y^{1/2})^4}\\
  &=\frac{1-x^2-y^2+x^2y^2}{d^2(1+x^{1/2})^4(1+y^{1/2})^4}\\
  &=\frac{(xy)^{-1}-(x/y)-(x/y)^{-1}+xy}{d^2(x^{-1/4}+x^{1/4})^4(y^{-1/4}+y^{1/4})^4}\\
  &=\frac{s}{d^2}\frac{z+z^{-1}-(\hat w+{\hat w}^{-1})}{(z^{1/2}+z^{-1/2}+{\hat w}^{1/2}+{\hat w}^{-1/2})^4}
\end{align}
where $s=\pm1$.
Using this shorthand, we transform from variables $\{\psi,x,y,d\}$ to $\{\psi,w,R,D\}$.
Of these latter coordinates, $R$ and $D$ are fully specified by the observed constraints on \eqref{eq:sigmapm},
but $\psi$ and $w$ are free. The transformation to these coordinates is
\begin{align}
  \psi&=\psi\\
  w&=\mathrm{sign}(\ln(xy))x/y^s\\
  R&=\frac{x^2+y^2+2xy\C}{1+x^2y^2+2xy\C}\\
  \Delta&=\frac{(1-x^2)(1-y^2)}{d^2(1+x^{1/2})^4(1+y^{1/2})^4}.
\end{align}
Note that we have added a sign to ${\hat w}=|w|$ as a convenient trick to
store the information about whether $xy$ is greater than $1$ to provide a bijective map over the full domain. 
Also, swapping the sign $s$, which we have not yet specified, reverses the roles of $w$ and the intermediate quantitity $z$.
The symmetry is realized by any translation in $\{\psi,w\}\rightarrow\{\psi',w'\}$ preserving $R$ and $D$.
The new coordinates are ten recovered from the inverse transformation, 
\begin{align}
  \psi&=\psi\\
  x&=\sqrt{z\hat w}\\
  y&=\sqrt{z/{\hat w}}\\
  d&={\Delta^{-1/2}}\frac {\sqrt{1+z^2-z(\hat w+{\hat w}^{-1})}}{(z^{1/2}+z^{-1/2}+{\hat w}^{1/2}+{\hat w}^{-1/2})^2}\\
  d&={\Delta^{-1/2}}\frac {\sqrt{z+z^{-1}-(\hat w+{\hat w}^{-1})}}{(z^{1/2}+z^{-1/2}+{\hat w}^{1/2}+{\hat w}^{-1/2})^2} \mathrm{(Which is right?)}
\end{align}
with $z=T+\mathrm{sign}(w)\sqrt{T^2-1}$ and $T=(({\hat w}+{\hat w}^{-1})/(2R^s)+\C(1-R^s)/R^s$ as intermediates.
Choosing $s=\mathrm{sign}(\ln(R))$, ensures that $0\leq R^s\leq1$, so that $z$ remains real. 
The Jacobian of the forward coordinate transformation its contribution to the Jacobian of the resulting
symmetry transformation are conveniently written in mixed notation,
\begin{align}
  |J|&=4\frac{wR\Delta}{xyd}\frac{z-z^{-1}}{z+z^{-1}+2\C},\\
  \frac{|J|}{|J'|}&=\frac{wx'y'd'}{w'xyd}\frac{z-z^{-1}}{z'-z'^{-1}}\frac{z'+z'^{-1}+2\cos(4\psi')}{z+z^{-1}+2\cos(4\psi)}.
\end{align}

The rest of the calculation proceeds to adjest the angles. Writing $\Psi_{\pm}=\mathrm{Arg}(x^{\pm1}e^{-2i\psi}+ye^{2i\psi})$,
we have
\begin{align}
  \mathrm{Arg}(\frac{\sigma_-}{\sigma_+})&=4\lambda+\Psi_--\Psi_+\\
  \mathrm{Arg}({\sigma_-}{\sigma_+})&=4\phi+\Psi_-+\Psi_+.
\end{align}
Each of these must be preserved through the symmetry transformation, which can be enforced by
\begin{align}
  \lambda'&=\lambda+\frac14(\Psi_--\Psi'_--\Psi_++\Psi'_+)\\
  \phi'&=\phi+\frac14(\Psi_--\Psi'_-+\Psi_+-\Psi'_+).
\end{align}


\end{document}
